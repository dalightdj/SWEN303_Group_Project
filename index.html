<!DOCTYPE html>
<html>

<head>
    <title>ANZ Championship</title>
    <script type="text/javascript" src="d3.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>


<body>

    <!-- Create filter box-->
    <form onclick="reloadData()">
        <input type="radio" name="year" id="2008Button" value="2008" checked/>2008
        <input type="radio" name="year" id="2009Button" value="2009" />2009
        <input type="radio" name="year" id="2010Button" value="2010" />2010
        <input type="radio" name="year" id="2011Button" value="2011" />2011
        <input type="radio" name="year" id="2012Button" value="2012" />2012
        <input type="radio" name="year" id="2013Button" value="2013" />2013
        <br/>
        <br/>
        <input type="radio" name="country" id="bothCountriesButton" value="both" checked/>Both
        <input type="radio" name="country" id="ausButton" value="aus" />Aus
        <input type="radio" name="country" id="nzButton" value="nz" />Nz
        <br/>
        <br/>
        <input type="radio" name="season" id="bothSeasonButton" value="bothSeasons" checked/>Both
        <input type="radio" name="season" id="regularButton" value="regular" />Regular
        <input type="radio" name="season" id="finalsButton" value="finals" />Finals
    </form>

    <input type="button" id="compareButton" onclick="" value="Compare" />



    <!-- The script which contians the filter box code -->
    <script type="text/javascript" src="filterBox.js"></script>
    <script>
        var width = 1500,
            height = 1500;

        //filter choices
        var yearChoices = [2013, 2012, 2011, 2010, 2009, 2008],
            countryChoices = ["NZ/Aus", "NZ", "Aus"],
            seasonTypeChoices = ["Regular/Finals", "Regular", "Finals"],
            teams = ["AdelaideThunderbirds", "CanterburyTactix", "CentralPulse", "MelbourneVixens", "NorthernMystics", "NSWSwifts", "QueenslandFirebirds", "SouthernSteel", "WaikatoBayOfPlentyMagic", "WestCoastFever"];

        //filters
        var file = "Tables/" + yearChoices[0] + "-Table1.csv",
            country = countryChoices[0],
            seasonType = seasonTypeChoices[0],
            compareTeam1 = teams[2],
            compareTeam2 = teams[8];





        //create container
        var canvas = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        //add background
        canvas.append("rect")
            .attr("rx", 20)
            .attr("ry", 20)
            // .attr("x", (width/2)-(comparisonBoxWidth/2))
            // .attr("y", 80)
            .attr("width", width)
            .attr("height", height)
            .attr("transform", function (d, i) {
                return "scale(" + (1 - d / 25) * 20 + ")";
            })
            .style("fill", "#00B8E6");



        //add header
        var header = canvas.append("g");

        //add logo
        header.append("svg:image")
            .attr("xlink:href", "Images/ANZChampionshipLogo.png")
            .attr("x", (width / 2) - 290)
            .attr("y", 5)
            .attr("width", 85)
            .attr("height", 85);

        header.append("text")
            .attr("x", (width / 2) + 130)
            .attr("y", 60)
            .attr("text-anchor", "middle")
            .attr("fill", "white")
            //.attr("stroke", "black")
            .attr("font-family", "sans-serif")
            .style("font-size", "45px")
            .style("font-weight", "600")
            .text("Championship");

        header.append("svg:image")
            .attr("xlink:href", "Images/ANZWhiteLogo.png")
            .attr("x", (width / 2) - 190)
            .attr("y", 0)
            .attr("width", 160)
            .attr("height", 75);



        //*******************************************
        //*************COMPARISONS BOX***************
        //*******************************************
        var comparisonsBoxWidth = 900,
            comparisonsBoxHeight = 600
        comparisonsBoxX = (width / 2) - (comparisonsBoxWidth / 2)
        comparisonsBoxY = 80;

        var comparisonsBox = canvas.append("g");

        //draw main box
        comparisonsBox.append("rect")
            .attr("rx", 20)
            .attr("ry", 20)
            .attr("x", comparisonsBoxX)
            .attr("y", comparisonsBoxY)
            .attr("width", comparisonsBoxWidth)
            .attr("height", comparisonsBoxHeight)
            .attr("transform", function (d, i) {
                return "scale(" + (1 - d / 25) * 20 + ")";
            })
            .style("fill", "#214282");
        //.style("fill", d3.scale.category20c());



        //draw logos
        var logoWidth = (comparisonsBoxWidth / 3),
            logoHeight = 160,
            logoPadding = 30,
            logoY = comparisonsBoxY + logoPadding;


        comparisonsBox.append("svg:image")
            .attr("xlink:href", "Images/Logos/" + compareTeam1 + ".jpg")
            .attr("x", comparisonsBoxX + logoPadding)
            .attr("y", logoY)
            .attr("width", logoWidth)
            .attr("height", logoHeight);

        comparisonsBox.append("svg:image")
            .attr("xlink:href", "Images/Logos/" + compareTeam2 + ".jpg")
            .attr("x", (comparisonsBoxX + comparisonsBoxWidth) - logoPadding - logoWidth)
            .attr("y", logoY)
            .attr("width", logoWidth)
            .attr("height", logoHeight);


        //draw text
        var comparisonsTextX = comparisonsBoxX + (comparisonsBoxWidth / 2),
            comparisonsTextY = logoY + (logoHeight / 2) + 5;

        comparisonsBox.append("text")
            .attr("x", comparisonsTextX)
            .attr("y", comparisonsTextY)
            .attr("text-anchor", "middle")
            .attr("fill", "white")
            .attr("font-family", "sans-serif")
            .style("font-size", "40px")
            .style("font-weight", "600")
            .text("vs");


        var comparisonsTextData = ["Wins", "Losses", "Home Wins", "Home Losses", "Goals For", "Goals Against", "Avg. Score"];
        comparisonsTextY += 130;

        for (var i = 0; i < comparisonsTextData.length; i++) {
            comparisonsBox.append("text")
                .attr("x", comparisonsTextX)
                .attr("y", comparisonsTextY)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-family", "sans-serif")
                .style("font-size", "30px")
                .style("font-weight", "500")
                .text(comparisonsTextData[i]);

            comparisonsTextY += 55;
        }

        //until i can access the filters
        compareTeam1 = "Central Pulse";
        compareTeam2 = "Waikato Bay of Plenty Magic"

        //get statistic values
        getTeamData.then(function (data) {

            //get left team's information
            comparisonsTextData = calcValues(data, compareTeam1);
            //add left side team's values to canvas
            comparisonsTextY = logoY + (logoHeight / 2) + 135;
            for (var i = 0; i < 7; i++) {
                comparisonsBox.append("text")
                    .attr("x", comparisonsTextX - 105)
                    .attr("y", comparisonsTextY)
                    .attr("text-anchor", "end")
                    .attr("fill", "white")
                    .attr("font-family", "sans-serif")
                    .style("font-size", "30px")
                    .style("font-weight", "500")
                    .text(comparisonsTextData[i]);

                comparisonsTextY += 55;
            }

            //get right team's information
            comparisonsTextData = calcValues(data, compareTeam2);
            //add values to canvas
            comparisonsTextY = logoY + (logoHeight / 2) + 135;
            for (var i = 0; i < 7; i++) {
                comparisonsBox.append("text")
                    .attr("x", comparisonsTextX + 105)
                    .attr("y", comparisonsTextY)
                    .attr("text-anchor", "start")
                    .attr("fill", "white")
                    .attr("font-family", "sans-serif")
                    .style("font-size", "30px")
                    .style("font-weight", "500")
                    .text(comparisonsTextData[i]);

                comparisonsTextY += 55;
            }



            //draw progress boz
            comparisonsTextY = logoY + (logoHeight / 2) + 135;
            for(var i = 7; i <comparisonsTextData.length; i++){
                comparisonsBox.append("text")
                    .attr("x", comparisonsTextX-165)
                    .attr("y", comparisonsTextY)
                    .attr("text-anchor", "end")
                    .attr("fill", "white")
                    .attr("font-family", "sans-serif")
                    .style("font-size", "30px")
                    .style("font-weight", "500")
                    .text("test " + i);

                 comparisonsTextY += 55;
            }
        });


        function calcValues(data, teamName) {
                var wins = 0,
                    losses = 0,
                    homeWins = 0,
                    homeLosses = 0,
                    goalsFor = 0,
                    goalsAgainst = 0,
                    averageScore = 0,
                    homeGame;

                for (var i = 0; i < data[teamName].length; i++) {
                    var roundData = data[teamName][i];

                    if (roundData["Home Team"] == teamName) {
                        homeGame = true;
                    } else if (roundData["Away Team"] == teamName) {
                        homeGame = false;
                    } else {
                        console.log("FAIL READING " + teamName + " round " + i);
                    }

                    var homeScore,
                        awayScore;

                    //GETSCORES//////////////////
                    /////////////////////////////

                    if (homeGame) {
                        averageScore += homeScore;
                        goalsFor += homeScore;
                        goalsAgainst += awayScore;

                        if (homeScore > awayScore) {
                            wins++;
                            homeWins++;
                        } else {
                            losses++;
                            homeLosses++;
                        }
                    } else {
                        averageScore += awayScore;
                        goalsFor += awayScore;
                        goalsAgainst += homeScore;

                        if (awayScore > homeScore) {
                            wins++;
                        } else {
                            losses++;
                        }
                    }
                }

                averageScore = averageScore/data[teamName].length;

                return comparisonsTextData = [wins, losses, homeWins, homeLosses, goalsFor, goalsAgainst, averageScore, wins/(wins+losses), losses/(wins+losses), homeWins/(homeWins+homeLosses), homeLosses/(homeWins+homeLosses)];//the first seven indices are the values, the second five are the percentages
            }
            //*******************************************
            //*******************************************
    </script>
    <!-- This is loaded here because it needs the canvas to be created because it uses it-->
    <script type="text/javascript" src="infomationBox.js"></script>
    <script>
        addInfoboxes();
    </script>
</body>

</html>